<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Students Portal – Koyoyo College Africa | Learning Resources</title>

  <meta name="description" content="Koyoyo College Students Portal – Access Google Classroom, study materials, academic calendar, exam results, and student resources.">
  <meta name="keywords" content="student portal, Google Classroom, study resources, academic calendar, exam results, Koyoyo College students">
  <meta name="author" content="Koyoyo College Africa">
  <meta name="theme-color" content="#0066ff">
  <meta property="og:title" content="Students Portal – Koyoyo College">
  <meta property="og:description" content="Access your learning resources and stay updated with your academic progress">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://koyoyocollege.github.io/Koyoyo-College-Africa/students.html">
  <meta property="og:image" content="https://i.imgur.com/QsV8xs6.webp">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Students Portal">
  <meta name="twitter:description" content="Access learning resources at Koyoyo College">
  <meta name="twitter:image" content="https://i.imgur.com/QsV8xs6.webp">
  <link rel="canonical" href="https://koyoyocollege.github.io/Koyoyo-College-Africa/students.html">
  <link rel="icon" type="image/webp" href="https://i.imgur.com/QsV8xs6.webp">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" async></script>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Outfit:wght@600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    /* --- START OF YOUR ORIGINAL CSS (Unchanged) --- 
    */
    :root {
      --primary: #0066ff; --secondary: #7c3aed; --background: #0f172a;
      --surface: rgba(30, 41, 59, 0.7); --surface-light: rgba(51, 65, 85, 0.5);
      --text-primary: #f1f5f9; --text-secondary: #cbd5e1; --accent: #06b6d4; --gold: #fbbf24;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Inter', Arial, sans-serif; background: linear-gradient(135deg, var(--background) 0%, #1a1f3a 100%); color: var(--text-primary); min-height: 100vh; }
    .container { max-width: 1100px; margin: 0 auto; padding: 28px; }
    header { background: linear-gradient(135deg, rgba(15, 23, 42, 0.95), rgba(30, 58, 138, 0.95)); backdrop-filter: blur(10px); padding: 16px 20px; position: sticky; top: 0; z-index: 1000; box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1); border-bottom: 1px solid rgba(96, 165, 250, 0.2); }
    .header-content { max-width: 1100px; margin: 0 auto; display: flex; align-items: center; justify-content: space-between; gap: 20px; }
    .logo-section { display: flex; align-items: center; gap: 12px; text-decoration: none; }
    .logo-img { width: 45px; height: 45px; object-fit: contain; border-radius: 8px; }
    .logo-text { color: white; font-size: 1.2em; font-weight: 700; background: linear-gradient(135deg, #60a5fa, #a78bfa); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    nav { display: flex; align-items: center; gap: 8px; }
    .nav-links { display: flex; gap: 4px; }
    .nav-link { color: #e0e7ff; text-decoration: none; padding: 8px 12px; border-radius: 8px; font-weight: 500; transition: all 0.3s ease; }
    .nav-link:hover, .nav-link.active { color: #60a5fa; background: rgba(96, 165, 250, 0.1); }
    .hamburger { display: none; flex-direction: column; gap: 4px; cursor: pointer; background: none; border: none; }
    .hamburger span { width: 24px; height: 2px; background: #60a5fa; border-radius: 1px; transition: all 0.3s ease; }
    
    /* ... (Rest of your original 1200 lines of CSS) ... */
    /* Only adding necessary Quiz Engine styles here */
    #quiz-engine-view { display: none; margin-bottom: 40px; }
    .quiz-card { background: var(--surface); padding: 30px; border-radius: 20px; border: 1.5px solid var(--accent); position: relative; }
    .timer-box { background: rgba(0,0,0,0.3); padding: 15px; border-radius: 12px; border: 1px solid var(--gold); text-align: center; margin-bottom: 20px; }
    #timer-display { font-family: 'Outfit', sans-serif; font-size: 2.5rem; font-weight: 700; color: var(--gold); }
    .question-step { display: none; animation: fadeIn 0.4s ease; }
    .question-step.active { display: block; }
    .option-label { display: flex; align-items: center; padding: 15px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; margin-bottom: 12px; cursor: pointer; transition: 0.3s; }
    .option-label:hover { background: rgba(0, 102, 255, 0.1); border-color: var(--primary); }
    .quiz-nav { display: flex; justify-content: space-between; margin-top: 25px; gap: 15px; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    /* (All your Hero, Cards-Grid, Calendar, Footer styles remain here unchanged) */
    .hero { background: linear-gradient(135deg, var(--surface) 0%, rgba(51, 65, 85, 0.3) 100%), url('https://i.imgur.com/ZuXOyGn.png') center/cover no-repeat; background-attachment: fixed; backdrop-filter: blur(30px); border-radius: 20px; padding: 60px 40px; text-align: center; margin-bottom: 60px; margin-top: 20px; display: flex; flex-direction: column; justify-content: center; align-items: center; }
    .cards-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 24px; margin: 60px 0; }
    /* ... (Skipping visual repetition of CSS for brevity, but it is all in your file) ... */
  </style>
</head>
<body>

  <header>
    <div class="header-content">
      <a href="index.html" class="logo-section">
        <img src="https://i.imgur.com/QsV8xs6.webp" alt="Koyoyo College Logo" class="logo-img">
        <div class="logo-text">KOYOYO COLLEGE AFRICA</div>
      </a>
      <nav>
        <button class="hamburger" id="hamburger"><span></span><span></span><span></span></button>
        <div class="nav-links" id="navLinks">
          <a href="index.html" class="nav-link">Home</a>
          <a href="students.html" class="nav-link active">Students</a>
          </div>
      </nav>
    </div>
  </header>

  <div id="login-root">
    <div class="portal-content-wrapper">
        <div id="login-container" class="auth-card">
            <h2>Koyoyo Portal Login</h2>
            <form id="login-form">
                <label for="email">Email:</label>
                <input type="email" id="email" required placeholder="student@example.com">
                <label for="password">Password:</label>
                <input type="password" id="password" required placeholder="••••••••">
                <button type="submit">Log In</button>
            </form>
            <p id="login-error-message"></p>
        </div>
    </div>
  </div>

  <div id="dashboard-container" style="display: none;">
    <div class="container">

        <div id="quiz-engine-view">
            <div class="timer-box">
                <div style="font-size: 0.9rem; color: var(--text-secondary); letter-spacing: 2px;">TIME REMAINING</div>
                <div id="timer-display">10:00</div>
            </div>
            <div class="quiz-card">
                <h2 id="quiz-title-header" style="margin-bottom: 20px; color: var(--accent);"></h2>
                <div id="questions-container"></div>
                <div class="quiz-nav">
                    <button type="button" id="prev-btn" class="btn secondary" style="width: 48%;">Previous</button>
                    <button type="button" id="next-btn" class="btn" style="width: 48%;">Next Question</button>
                    <button type="button" id="submit-quiz-btn" class="btn" style="display:none; background: #10b981; width: 48%;">Finish Quiz</button>
                </div>
            </div>
            <hr style="margin: 40px 0; border: 0; border-top: 1px solid rgba(255,255,255,0.1);">
        </div>

        <section class="hero" id="portal-hero">
            <h1>Welcome, <span id="user-email-display"></span>!</h1>
            <p>Access your learning resources, schedules, and important updates all in one place</p>
        </section>

        <div class="cards-grid">
            <div class="card">
                <div class="card-icon"><i class="fas fa-question-circle"></i></div>
                <h3>Available Quizzes</h3>
                <div style="display: flex; flex-direction: column; gap: 10px;">
                    <a href="quiz.html?id=Maths Test 1" class="btn" style="text-align: left;"><i class="fas fa-calculator"></i> Mathematics Quiz</a>
                    <a href="quiz.html?id=ICT Test 1" class="btn" style="text-align: left;"><i class="fas fa-book"></i> ICT Quiz</a>
                </div>
            </div>
        </div>

        <button id="logout-button" class="btn" style="background: #e11d48; margin-top: 20px; max-width: 200px;">Log Out</button>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js';
    import { getFirestore, doc, getDoc, collection, query, where, orderBy, getDocs, addDoc, serverTimestamp } from 'https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js';

    // ... (Your firebaseConfig) ...
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Quiz Global Variables
    let quizQuestions = [];
    let currentStep = 0;
    const urlParams = new URLSearchParams(window.location.search);
    const quizId = urlParams.get('id');

    // Authentication Observer
    onAuthStateChanged(auth, async (user) => {
        if (user) {
            document.getElementById('login-root').style.display = 'none';
            document.getElementById('dashboard-container').style.display = 'block';
            document.getElementById('user-email-display').textContent = user.email;
            
            // IF a Quiz ID is in the URL, initialize the quiz engine
            if (quizId) {
                document.getElementById('quiz-engine-view').style.display = 'block';
                document.getElementById('portal-hero').style.display = 'none'; // Only hide hero to focus on quiz
                loadQuizQuestions(quizId, user.uid);
            }
            
            loadQuizHistory(user.uid);
        } else {
            document.getElementById('login-root').style.display = 'block';
            document.getElementById('dashboard-container').style.display = 'none';
        }
    });

    // --- NEW: LOAD QUESTIONS LOGIC ---
    async function loadQuizQuestions(id, uid) {
        document.getElementById('quiz-title-header').textContent = "Exam: " + id;
        const q = query(collection(db, "questions"), where("quizId", "==", id));
        const querySnapshot = await getDocs(q);
        
        const container = document.getElementById('questions-container');
        querySnapshot.forEach((doc, index) => {
            const data = doc.data();
            quizQuestions.push({ id: doc.id, ...data });

            const stepDiv = document.createElement('div');
            stepDiv.className = `question-step ${index === 0 ? 'active' : ''}`;
            stepDiv.id = `q-step-${index}`;
            stepDiv.innerHTML = `
                <p style="font-size: 1.25rem; margin-bottom: 25px; line-height: 1.6;">${data.question}</p>
                ${data.options.map(opt => `
                    <label class="option-label">
                        <input type="radio" name="q${index}" value="${opt}" style="margin-right: 15px; transform: scale(1.3);">
                        <span>${opt}</span>
                    </label>
                `).join('')}
            `;
            container.appendChild(stepDiv);
        });

        startQuizTimer(uid);
        updateQuizNavigation();
    }

    // --- NEW: TIMER LOGIC ---
    function startQuizTimer(uid) {
        let timeLeft = 600; // 10 Minutes
        const timerInterval = setInterval(() => {
            timeLeft--;
            const mins = Math.floor(timeLeft / 60);
            const secs = timeLeft % 60;
            document.getElementById('timer-display').textContent = `${mins}:${secs < 10 ? '0' : ''}${secs}`;
            
            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                submitFinalResults(uid);
            }
        }, 1000);
    }

    function updateQuizNavigation() {
        document.getElementById('prev-btn').style.visibility = currentStep === 0 ? 'hidden' : 'visible';
        const isLast = currentStep === quizQuestions.length - 1;
        document.getElementById('next-btn').style.display = isLast ? 'none' : 'block';
        document.getElementById('submit-quiz-btn').style.display = isLast ? 'block' : 'none';
        
        if (window.MathJax) MathJax.typesetPromise();
    }

    document.getElementById('next-btn').onclick = () => {
        document.getElementById(`q-step-${currentStep}`).classList.remove('active');
        currentStep++;
        document.getElementById(`q-step-${currentStep}`).classList.add('active');
        updateQuizNavigation();
    };

    document.getElementById('prev-btn').onclick = () => {
        document.getElementById(`q-step-${currentStep}`).classList.remove('active');
        currentStep--;
        document.getElementById(`q-step-${currentStep}`).classList.add('active');
        updateQuizNavigation();
    };

    async function submitFinalResults(uid) {
        let score = 0;
        quizQuestions.forEach((q, i) => {
            const selected = document.querySelector(`input[name="q${i}"]:checked`)?.value;
            if (selected === q.answer) score++;
        });

        await addDoc(collection(db, "quizResults"), {
            userId: uid,
            quizId: quizId,
            score: score,
            totalQuestions: quizQuestions.length,
            timestamp: serverTimestamp()
        });

        alert("Quiz Submitted! Your score: " + score);
        window.location.href = "quiz.html"; // Go back to dashboard
    }

    document.getElementById('submit-quiz-btn').onclick = () => submitFinalResults(auth.currentUser.uid);

    // (Remaining login and history functions from your original code...)
  </script>

  </body>
</html>
